<!DOCTYPE html>
<html lang="zh-CN">
<head>
    {% include head-base.html %}
    
    <!-- ç›®å½•ç‰¹æœ‰æ ·å¼ -->
    <style>
    /* ç›®å½•ä¾§è¾¹æ æ ·å¼ - å›¾äºŒæŠ˜å æ•ˆæœ */
    .toc-sidebar {
        position: fixed;
        top: 0;
        right: -300px; /* é»˜è®¤éšè—åœ¨å±å¹•å¤– */
        width: 280px;
        height: 100vh;
        background: linear-gradient(135deg, #ffd1dc, #ffb6c1);
        z-index: 1000;
        padding: 20px 15px;
        transition: right 0.3s ease;
        overflow-y: auto;
        box-shadow: -5px 0 15px rgba(0,0,0,0.2);
        border-left: 3px solid #ff69b4;
    }
    
    .toc-sidebar.active {
        right: 0; /* æ¿€æ´»æ—¶æ»‘å…¥å±å¹• */
    }
    
    .toc-header {
        color: #ff1493;
        font-size: 1.3em;
        font-weight: bold;
        margin-bottom: 15px;
        text-align: center;
        padding-bottom: 10px;
        border-bottom: 2px dashed #ff69b4;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .toc-close {
        background: none;
        border: none;
        font-size: 1.2em;
        color: #ff69b4;
        cursor: pointer;
        padding: 5px;
        border-radius: 50%;
        transition: background 0.3s;
    }
    
    .toc-close:hover {
        background: rgba(255, 105, 180, 0.1);
    }
    
    .toc-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .toc-item {
        margin-bottom: 8px;
    }
    
    .toc-link {
        color: #666;
        text-decoration: none;
        display: flex;
        align-items: center;
        padding: 12px 15px;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-size: 0.9em;
        background: rgba(255, 255, 255, 0.7);
        line-height: 1.4;
        border-left: 3px solid transparent;
    }
    
    .toc-link:hover {
        background: rgba(255, 255, 255, 0.9);
        color: #ff1493;
        border-left-color: #ff69b4;
        transform: translateX(3px);
    }
    
    .toc-link.active {
        background: rgba(255, 255, 255, 0.95);
        color: #ff1493;
        font-weight: bold;
        border-left-color: #ff1493;
    }
    
    .toc-bullet {
        margin-right: 8px;
        color: #ff69b4;
        font-size: 0.8em;
    }
    
    /* æ±‰å ¡èœå•æŒ‰é’® */
    .hamburger-menu {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background: #ff69b4;
        border: none;
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        z-index: 1001;
        box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4);
        transition: all 0.3s ease;
    }
    
    .hamburger-menu:hover {
        background: #ff1493;
        transform: scale(1.1);
    }
    
    .hamburger-line {
        width: 20px;
        height: 2px;
        background: white;
        margin: 2px 0;
        border-radius: 1px;
        transition: all 0.3s ease;
    }
    
    .hamburger-menu.active .hamburger-line:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
    }
    
    .hamburger-menu.active .hamburger-line:nth-child(2) {
        opacity: 0;
    }
    
    .hamburger-menu.active .hamburger-line:nth-child(3) {
        transform: rotate(-45deg) translate(7px, -6px);
    }
    
    /* é®ç½©å±‚ */
    .toc-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }
    
    .toc-overlay.active {
        opacity: 1;
        visibility: visible;
    }
    
    /* å±‚çº§ç¼©è¿› */
    .toc-level-3 .toc-link {
        padding-left: 25px;
        background: rgba(255, 255, 255, 0.6);
    }
    
    .toc-level-4 .toc-link {
        padding-left: 40px;
        background: rgba(255, 255, 255, 0.5);
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
        .toc-sidebar {
            width: 85%;
            right: -100%;
        }
        
        .hamburger-menu {
            top: 15px;
            right: 15px;
            width: 45px;
            height: 45px;
        }
    }
    
    @media (min-width: 1200px) {
        .hamburger-menu {
            display: none;
        }
        
        .toc-sidebar {
            right: 0;
            width: 300px;
        }
    }
    </style>
</head>
<body>
    <!-- æ±‰å ¡èœå•æŒ‰é’® -->
    <button class="hamburger-menu" id="hamburgerMenu">
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
    </button>
    
    <!-- é®ç½©å±‚ -->
    <div class="toc-overlay" id="tocOverlay"></div>
    
    <!-- ç›®å½•ä¾§è¾¹æ  -->
    <aside class="toc-sidebar" id="tocSidebar">
        <div class="toc-header">
            <span>ğŸ“‘ æ–‡ç« ç›®å½•</span>
            <button class="toc-close" id="tocClose">âœ•</button>
        </div>
        <ul class="toc-list" id="tocList">
            <!-- ç›®å½•å†…å®¹ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </ul>
    </aside>
    
    <div class="container">
        <article class="post">
            {% include post-header.html %}
            
            <div class="post-content">
                {{ content }}
            </div>
            
            {% include post-footer.html %}
        </article>
    </div>
    
    <!-- ä¿®æ”¹åçš„JavaScriptæ§åˆ¶é€»è¾‘ -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // è·å–DOMå…ƒç´ 
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const tocSidebar = document.getElementById('tocSidebar');
        const tocOverlay = document.getElementById('tocOverlay');
        const tocList = document.getElementById('tocList');
        const tocClose = document.getElementById('tocClose');
        
        // ç¡®ä¿ç›®å½•é»˜è®¤éšè—
        hideToc();
        
        // è·å–æ‰€æœ‰æ ‡é¢˜å…ƒç´ 
        const headings = document.querySelectorAll('h2, h3, h4');
        
        // ç”Ÿæˆç›®å½•
        if (headings.length > 0) {
            headings.forEach((heading, index) => {
                // ç¡®ä¿æ ‡é¢˜æœ‰ID
                if (!heading.id) {
                    heading.id = 'heading-' + index;
                }
                
                // åˆ›å»ºç›®å½•é¡¹
                const listItem = document.createElement('li');
                listItem.className = 'toc-item';
                
                // æ ¹æ®æ ‡é¢˜çº§åˆ«æ·»åŠ å±‚çº§æ ·å¼
                const level = parseInt(heading.tagName.substring(1));
                if (level === 3) {
                    listItem.classList.add('toc-level-3');
                } else if (level === 4) {
                    listItem.classList.add('toc-level-4');
                }
                
                // åˆ›å»ºé“¾æ¥
                const link = document.createElement('a');
                link.href = '#' + heading.id;
                link.className = 'toc-link';
                link.innerHTML = '<span class="toc-bullet">ğŸ¾</span>' + heading.textContent;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    hideToc(); // ç‚¹å‡»ç›®å½•é¡¹åéšè—ç›®å½•
                    
                    // å¹³æ»‘æ»šåŠ¨åˆ°å¯¹åº”æ ‡é¢˜
                    const targetElement = document.getElementById(heading.id);
                    if (targetElement) {
                        const offsetTop = targetElement.offsetTop - 80;
                        window.scrollTo({
                            top: offsetTop,
                            behavior: 'smooth'
                        });
                    }
                });
                
                listItem.appendChild(link);
                tocList.appendChild(listItem);
            });
        } else {
            // å¦‚æœæ²¡æœ‰æ ‡é¢˜ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
            tocList.innerHTML = '<li class="toc-item"><span style="color: #888; font-style: italic;">è¿™ç¯‡æ–‡ç« æ²¡æœ‰æ ‡é¢˜ç»“æ„</span></li>';
        }
        
        // æ±‰å ¡èœå•ç‚¹å‡»äº‹ä»¶ - åˆ‡æ¢ç›®å½•æ˜¾ç¤º/éšè—
        hamburgerMenu.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleToc();
        });
        
        // å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        tocClose.addEventListener('click', function(e) {
            e.stopPropagation();
            hideToc();
        });
        
        // é®ç½©å±‚ç‚¹å‡»äº‹ä»¶ - ç‚¹å‡»é®ç½©å±‚å…³é—­ç›®å½•
        tocOverlay.addEventListener('click', function() {
            hideToc();
        });
        
        // ç‚¹å‡»ç›®å½•å¤–éƒ¨å…³é—­ç›®å½•
        document.addEventListener('click', function(e) {
            if (!tocSidebar.contains(e.target) && e.target !== hamburgerMenu) {
                hideToc();
            }
        });
        
        // é˜»æ­¢ç›®å½•å†…éƒ¨ç‚¹å‡»äº‹ä»¶å†’æ³¡
        tocSidebar.addEventListener('click', function(e) {
            e.stopPropagation();
        });
        
        // ESCé”®å…³é—­ç›®å½•
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideToc();
            }
        });
        
        // æ»šåŠ¨æ—¶é«˜äº®å½“å‰ç« èŠ‚
        function highlightActiveToc() {
            const tocLinks = document.querySelectorAll('.toc-link');
            let activeIndex = -1;
            
            // æ‰¾åˆ°å½“å‰å¯è§çš„æ ‡é¢˜
            for (let i = headings.length - 1; i >= 0; i--) {
                const rect = headings[i].getBoundingClientRect();
                if (rect.top <= 100) { // è·ç¦»é¡¶éƒ¨100pxä»¥å†…
                    activeIndex = i;
                    break;
                }
            }
            
            // æ›´æ–°æ¿€æ´»çŠ¶æ€
            tocLinks.forEach((link, index) => {
                link.classList.remove('active');
                if (index === activeIndex) {
                    link.classList.add('active');
                }
            });
        }
        
        // ç›‘å¬æ»šåŠ¨äº‹ä»¶
        window.addEventListener('scroll', highlightActiveToc);
        
        // åˆå§‹åŒ–é«˜äº®
        setTimeout(highlightActiveToc, 100);
        
        // æ§åˆ¶å‡½æ•°
        function toggleToc() {
            hamburgerMenu.classList.toggle('active');
            tocSidebar.classList.toggle('active');
            tocOverlay.classList.toggle('active');
        }
        
        function hideToc() {
            hamburgerMenu.classList.remove('active');
            tocSidebar.classList.remove('active');
            tocOverlay.classList.remove('active');
        }
        
        function showToc() {
            hamburgerMenu.classList.add('active');
            tocSidebar.classList.add('active');
            tocOverlay.classList.add('active');
        }
        
        // å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ï¼Œæ–¹ä¾¿å…¶ä»–å…ƒç´ è°ƒç”¨
        window.toggleToc = toggleToc;
        window.hideToc = hideToc;
        window.showToc = showToc;
        
        // ç§»åŠ¨ç«¯è§¦æ‘¸ä¼˜åŒ–
        let startX = 0;
        let currentX = 0;
        
        tocSidebar.addEventListener('touchstart', function(e) {
            startX = e.touches[0].clientX;
        });
        
        tocSidebar.addEventListener('touchmove', function(e) {
            currentX = e.touches[0].clientX;
        });
        
        tocSidebar.addEventListener('touchend', function(e) {
            const diffX = startX - currentX;
            // å¦‚æœä»å³å‘å·¦æ»‘åŠ¨è¶…è¿‡50pxï¼Œå…³é—­ç›®å½•
            if (diffX > 50) {
                hideToc();
            }
        });
    });
    </script>
</body>
</html>
